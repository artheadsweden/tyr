version: 1
last_reviewed: "2026-02-17"

# allowed_agent_actions is a formal enum.
allowed_agent_actions:
  - allow
  - block_and_ask_user
  - generate_manual_plan_only
  - generate_constraints_only
  - require_intent_update

# Semantics for each allowed agent action.
semantics:
  allow: "Proceed normally within zone constraints."
  block_and_ask_user: "Stop immediately and ask the user for explicit direction before continuing."
  generate_manual_plan_only: "Do not perform the operation. Produce a manual change plan with rationale and validation steps."
  generate_constraints_only: "Do not perform the operation. Produce only constraints/guardrails and questions needed to proceed safely."
  require_intent_update: "Stop and request an intent update that explicitly authorizes and constrains the red operation."

# Defaults apply when an operation match is ambiguous.
defaults:
  treat_as_red: true
  agent_action: "block_and_ask_user"

operations:
  - id: "identity_and_access_control"
    title: "Authentication and authorization changes"
    description: "Any modification that could affect identity, sessions, roles, permissions, policy checks, or token validation."
    match:
      paths:
        - "src/auth/"
        - "src/security/"
      patterns:
        - "auth"
        - "authorize"
        - "permission"
        - "role"
        - "session"
        - "token"
    enforcement:
      treat_as_red: true
      agent_action: "generate_manual_plan_only"

  - id: "governance_runtime_surface"
    title: "Governance/runtime control surface changes"
    description: "Changes to governance configuration and runtime pointers."
    match:
      paths:
        - ".id-sdlc/"
      patterns:
        - "orange_write_allowlist"
        - "allowed_agent_actions"
        - "current-intent"
    enforcement:
      treat_as_red: true
      agent_action: "block_and_ask_user"

  - id: "dependency_manifest_changes"
    title: "Dependency manifest changes"
    description: "Dependency updates can introduce supply-chain risk."
    match:
      paths:
        - "requirements.txt"
        - "pyproject.toml"
        - "package.json"
        - "package-lock.json"
      patterns: []
    enforcement:
      treat_as_red: true
      agent_action: "block_and_ask_user"

# Uncertainty policy: do not guess.
uncertainty_policy:
  when_unsure_if_red:
    required_behavior: "stop_and_ask"
    required_details:
      - "why this might be red"
      - "exact file paths"
      - "the smallest required change"
      - "what could go wrong if classified incorrectly"
